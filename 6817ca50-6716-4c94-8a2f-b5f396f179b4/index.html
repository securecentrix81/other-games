<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clicker Game Generator</title>
    <style>
        :root {
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --secondary: #f1f5f9;
            --danger: #ef4444;
            --danger-hover: #dc2626;
            --success: #22c55e;
            --text: #1e293b;
            --text-light: #64748b;
            --border: #e2e8f0;
            --bg: #f8fafc;
            --card: #ffffff;
            --radius: 12px;
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        /* ==================== EDITOR STYLES ==================== */
        #editor-mode {
            min-height: 100vh;
            padding: 2rem;
        }

        .editor-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .editor-header h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary), #a855f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .editor-header p {
            color: var(--text-light);
            font-size: 1.1rem;
        }

        .editor-container {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        @media (max-width: 1024px) {
            .editor-container {
                grid-template-columns: 1fr;
            }
            .preview-panel {
                order: -1;
            }
        }

        .form-panel {
            background: var(--card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 2rem;
        }

        .form-section {
            margin-bottom: 2rem;
        }

        .form-section h2 {
            font-size: 1.25rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-section h2 .icon {
            width: 24px;
            height: 24px;
            background: var(--primary);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.875rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .form-group input, .form-group textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s, box-shadow 0.2s;
            font-family: inherit;
        }

        .form-group input:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .form-group small {
            display: block;
            color: var(--text-light);
            font-size: 0.8rem;
            margin-top: 0.25rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        /* Upgrade Builder */
        .upgrade-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .upgrade-card {
            background: var(--secondary);
            border-radius: 8px;
            padding: 1rem;
            position: relative;
        }

        .upgrade-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .upgrade-card-header span {
            font-weight: 600;
            color: var(--primary);
        }

        .upgrade-card .form-row {
            margin-bottom: 0.5rem;
        }

        .upgrade-card input, .upgrade-card textarea {
            background: white;
            padding: 0.5rem 0.75rem;
            font-size: 0.9rem;
        }

        .upgrade-card textarea {
            resize: vertical;
            min-height: 60px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .btn-secondary {
            background: var(--secondary);
            color: var(--text);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
            padding: 0.4rem 0.75rem;
            font-size: 0.8rem;
        }

        .btn-danger:hover {
            background: var(--danger-hover);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #16a34a;
        }

        .btn-block {
            width: 100%;
        }

        .btn-lg {
            padding: 1rem 2rem;
            font-size: 1.1rem;
        }

        /* Preview Panel */
        .preview-panel {
            position: sticky;
            top: 2rem;
            height: fit-content;
        }

        .preview-container {
            background: var(--card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .preview-header {
            background: linear-gradient(135deg, var(--primary), #a855f7);
            color: white;
            padding: 1rem;
            text-align: center;
            font-weight: 600;
        }

        .preview-game {
            height: 500px;
            position: relative;
            background-size: 50px;
            background-color: #f0f0f0;
        }

        .preview-inner {
            position: absolute;
            inset: 10px;
            background: white;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem;
        }

        .preview-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .preview-count {
            font-size: 1rem;
            color: var(--text-light);
            margin-bottom: 1rem;
            font-family: monospace;
        }

        .preview-clicker {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            cursor: pointer;
            transition: transform 0.1s;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--secondary);
        }

        .preview-clicker:hover {
            transform: scale(1.05);
        }

        .preview-clicker:active {
            transform: scale(0.95);
        }

        .preview-clicker img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .preview-clicker-placeholder {
            color: var(--text-light);
            font-size: 0.8rem;
            text-align: center;
        }

        /* Generated Link Section */
        .link-section {
            margin-top: 2rem;
            padding: 1.5rem;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(168, 85, 247, 0.1));
            border-radius: var(--radius);
            border: 2px dashed var(--primary);
        }

        .link-section h3 {
            margin-bottom: 1rem;
            color: var(--primary);
        }

        .link-output {
            display: flex;
            gap: 0.5rem;
        }

        .link-output input {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.9rem;
        }

        /* ==================== PLAYER STYLES ==================== */
        #player-mode {
            display: none;
        }

        .game-wrapper {
            min-height: 100vh;
            background-size: 50px;
            background-color: #f0f0f0;
            position: relative;
        }

        .game-container {
            position: fixed;
            top: 5%;
            left: 5%;
            width: 90%;
            height: 90%;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }

        .game-view {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .game-header {
            text-align: center;
            padding: 1.5rem;
            background: linear-gradient(135deg, var(--primary), #a855f7);
            color: white;
        }

        .game-header h1 {
            font-size: 1.75rem;
            margin-bottom: 0.25rem;
        }

        .game-stats {
            display: flex;
            justify-content: center;
            gap: 2rem;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .game-count {
            font-size: 1.5rem;
            font-weight: 700;
            font-family: monospace;
            text-align: center;
            padding: 1rem;
            background: var(--secondary);
        }

        .game-main {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .game-clicker {
            width: 250px;
            height: 250px;
            border-radius: 50%;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            cursor: pointer;
            transition: transform 0.1s;
            background: var(--secondary);
        }

        .game-clicker:hover {
            transform: scale(1.08);
        }

        .game-clicker:active {
            transform: scale(1.2);
            transition: transform 0s;
        }

        .game-clicker img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            pointer-events: none;
        }

        .game-nav {
            display: flex;
            border-top: 2px solid var(--border);
        }

        .game-nav button {
            flex: 1;
            padding: 1rem;
            border: none;
            background: var(--secondary);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            font-family: inherit;
        }

        .game-nav button:hover {
            background: var(--border);
        }

        .game-nav button.active {
            background: var(--primary);
            color: white;
        }

        /* Shop View */
        .shop-view {
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
        }

        .shop-view.active {
            display: flex;
        }

        .game-view.hidden {
            display: none;
        }

        .shop-list {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .shop-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            margin-bottom: 0.75rem;
            background: var(--secondary);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .shop-item:hover:not(.locked):not(.hidden) {
            border-color: var(--primary);
            transform: translateX(4px);
        }

        .shop-item.locked {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .shop-item.hidden {
            opacity: 0.4;
            cursor: not-allowed;
            background: #e8e8e8;
        }

        .shop-item-info {
            flex: 1;
        }

        .shop-item-title {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
        }

        .shop-item-subtitle {
            font-size: 0.85rem;
            color: var(--text-light);
            white-space: pre-wrap;
        }

        .shop-item-meta {
            text-align: right;
        }

        .shop-item-cost {
            font-weight: 700;
            color: var(--primary);
            font-size: 1rem;
        }

        .shop-item-owned {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        /* Click Effects */
        .click-effect {
            position: fixed;
            pointer-events: none;
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--primary);
            animation: floatUp 0.8s ease-out forwards;
            z-index: 9999;
        }

        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-60px) scale(0.5);
            }
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: var(--text);
            color: white;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-weight: 600;
            z-index: 10000;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-light);
        }

        .empty-state svg {
            width: 64px;
            height: 64px;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Responsive */
        @media (max-width: 640px) {
            #editor-mode {
                padding: 1rem;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
            .form-panel {
                padding: 1rem;
            }
            .game-clicker {
                width: 180px;
                height: 180px;
            }
        }
    </style>
</head>
<body>

<!-- ==================== EDITOR MODE ==================== -->
<div id="editor-mode">
    <header class="editor-header">
        <h1>üéÆ Clicker Game Generator</h1>
        <p>Create your own custom clicker game and share it with friends!</p>
    </header>

    <div class="editor-container">
        <div class="form-panel">
            <!-- Basic Settings -->
            <div class="form-section">
                <h2><span class="icon">1</span> Basic Settings</h2>
                <div class="form-group">
                    <label for="game-name">Game Name</label>
                    <input type="text" id="game-name" placeholder="e.g., Cookie Clicker" value="My Clicker Game">
                </div>
                <div class="form-group">
                    <label for="clicker-image">Clicker Image URL</label>
                    <input type="url" id="clicker-image" placeholder="https://example.com/image.png">
                    <small>The main image players will click on</small>
                </div>
                <div class="form-group">
                    <label for="background-image">Background Pattern URL (optional)</label>
                    <input type="url" id="background-image" placeholder="https://example.com/pattern.png">
                    <small>A small image that tiles as the background</small>
                </div>
                <div class="form-group">
                    <label for="unit-name">Unit Name</label>
                    <input type="text" id="unit-name" placeholder="e.g., cookies, points" value="points">
                    <small>What players are collecting (e.g., "cookies", "coins")</small>
                </div>
            </div>

            <!-- Upgrades -->
            <div class="form-section">
                <h2><span class="icon">2</span> Upgrades</h2>
                <p style="color: var(--text-light); margin-bottom: 1rem; font-size: 0.9rem;">
                    Add upgrades that players can purchase. They unlock progressively.
                </p>
                <div class="upgrade-list" id="upgrade-list">
                    <!-- Upgrades will be added here dynamically -->
                </div>
                <button class="btn btn-secondary btn-block" onclick="addUpgrade()" style="margin-top: 1rem;">
                    ‚ûï Add Upgrade
                </button>
            </div>

            <!-- Generate -->
            <div class="form-section">
                <h2><span class="icon">3</span> Generate & Share</h2>
                <button class="btn btn-primary btn-lg btn-block" onclick="generateGame()">
                    üöÄ Generate Game Link
                </button>
                <div class="link-section" id="link-section" style="display: none;">
                    <h3>‚úÖ Your game is ready!</h3>
                    <div class="link-output">
                        <input type="text" id="generated-link" readonly>
                        <button class="btn btn-success" onclick="copyLink()">üìã Copy</button>
                    </div>
                    <p style="margin-top: 1rem; font-size: 0.9rem; color: var(--text-light);">
                        Share this link with anyone to let them play your game!
                    </p>
                    <button class="btn btn-primary" onclick="playGame()" style="margin-top: 0.5rem;">
                        ‚ñ∂Ô∏è Play Now
                    </button>
                </div>
            </div>
        </div>

        <!-- Preview Panel -->
        <div class="preview-panel">
            <div class="preview-container">
                <div class="preview-header">Live Preview</div>
                <div class="preview-game" id="preview-game">
                    <div class="preview-inner">
                        <div class="preview-title" id="preview-title">My Clicker Game</div>
                        <div class="preview-count">0 <span id="preview-unit">points</span></div>
                        <div class="preview-clicker" id="preview-clicker">
                            <div class="preview-clicker-placeholder">
                                Add an image URL above
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ==================== PLAYER MODE ==================== -->
<div id="player-mode">
    <div class="game-wrapper" id="game-wrapper">
        <div class="game-container">
            <!-- Main Game View -->
            <div class="game-view" id="main-view">
                <div class="game-header">
                    <h1 id="game-title">Clicker Game</h1>
                    <div class="game-stats">
                        <span>‚ö° <span id="stat-power">1</span> per click</span>
                        <span>üîÑ <span id="stat-auto">0</span>/sec</span>
                    </div>
                </div>
                <div class="game-count" id="game-count">0 points</div>
                <div class="game-main">
                    <div class="game-clicker" id="game-clicker">
                        <img src="" alt="Clicker" id="game-clicker-img">
                    </div>
                </div>
                <div class="game-nav">
                    <button class="active" onclick="showView('main')">üéÆ Click</button>
                    <button onclick="showView('shop')">üõí Shop</button>
                </div>
            </div>

            <!-- Shop View -->
            <div class="shop-view" id="shop-view">
                <div class="game-header">
                    <h1>üõí Upgrade Shop</h1>
                </div>
                <div class="game-count" id="shop-count">0 points</div>
                <div class="shop-list" id="shop-list">
                    <!-- Shop items generated dynamically -->
                </div>
                <div class="game-nav">
                    <button onclick="showView('main')">üéÆ Click</button>
                    <button class="active" onclick="showView('shop')">üõí Shop</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// ==================== LZ-STRING COMPRESSION LIBRARY ====================
var LZString=function(){function o(o,r){if(!t[o]){t[o]={};for(var n=0;n<o.length;n++)t[o][o.charAt(n)]=n}return t[o][r]}var r=String.fromCharCode,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",t={},i={compressToBase64:function(o){if(null==o)return"";var r=i._compress(o,6,function(o){return n.charAt(o)});switch(r.length%4){default:case 0:return r;case 1:return r+"===";case 2:return r+"==";case 3:return r+"="}},decompressFromBase64:function(r){return null==r?"":""==r?null:i._decompress(r.length,32,function(e){return o(n,r.charAt(e))})},compressToUTF16:function(o){return null==o?"":i._compress(o,15,function(o){return r(o+32)})+" "},decompressFromUTF16:function(o){return null==o?"":""==o?null:i._decompress(o.length,16384,function(r){return o.charCodeAt(r)-32})},compressToUint8Array:function(o){for(var r=i.compress(o),n=new Uint8Array(2*r.length),e=0,t=r.length;t>e;e++){var s=r.charCodeAt(e);n[2*e]=s>>>8,n[2*e+1]=s%256}return n},decompressFromUint8Array:function(o){if(null===o||void 0===o)return i.decompress(o);for(var n=new Array(o.length/2),e=0,t=n.length;t>e;e++)n[e]=256*o[2*e]+o[2*e+1];var s=[];return n.forEach(function(o){s.push(r(o))}),i.decompress(s.join(""))},compressToEncodedURIComponent:function(o){return null==o?"":i._compress(o,6,function(o){return e.charAt(o)})},decompressFromEncodedURIComponent:function(r){return null==r?"":""==r?null:(r=r.replace(/ /g,"+"),i._decompress(r.length,32,function(n){return o(e,r.charAt(n))}))},compress:function(o){return i._compress(o,16,function(o){return r(o)})},_compress:function(o,r,n){if(null==o)return"";var e,t,i,s={},p={},u="",c="",a="",l=2,f=3,h=2,d=[],m=0,v=0;for(i=0;i<o.length;i+=1)if(u=o.charAt(i),Object.prototype.hasOwnProperty.call(s,u)||(s[u]=f++,p[u]=!0),c=a+u,Object.prototype.hasOwnProperty.call(s,c))a=c;else{if(Object.prototype.hasOwnProperty.call(p,a)){if(a.charCodeAt(0)<256){for(e=0;h>e;e++)m<<=1,v==r-1?(v=0,d.push(n(m)),m=0):v++;for(t=a.charCodeAt(0),e=0;8>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1}else{for(t=1,e=0;h>e;e++)m=m<<1|t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t=0;for(t=a.charCodeAt(0),e=0;16>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1}l--,0==l&&(l=Math.pow(2,h),h++),delete p[a]}else for(t=s[a],e=0;h>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1;l--,0==l&&(l=Math.pow(2,h),h++),s[c]=f++,a=String(u)}if(""!==a){if(Object.prototype.hasOwnProperty.call(p,a)){if(a.charCodeAt(0)<256){for(e=0;h>e;e++)m<<=1,v==r-1?(v=0,d.push(n(m)),m=0):v++;for(t=a.charCodeAt(0),e=0;8>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1}else{for(t=1,e=0;h>e;e++)m=m<<1|t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t=0;for(t=a.charCodeAt(0),e=0;16>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1}l--,0==l&&(l=Math.pow(2,h),h++),delete p[a]}else for(t=s[a],e=0;h>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1;l--,0==l&&(l=Math.pow(2,h),h++)}for(t=2,e=0;h>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1;for(;;){if(m<<=1,v==r-1){d.push(n(m));break}v++}return d.join("")},decompress:function(o){return null==o?"":""==o?null:i._decompress(o.length,32768,function(r){return o.charCodeAt(r)})},_decompress:function(o,n,e){var t,i,s,p,u,c,a,l,f=[],h=4,d=4,m=3,v="",w=[],A={val:e(0),position:n,index:1};for(i=0;3>i;i+=1)f[i]=i;for(p=0,c=Math.pow(2,2),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;switch(t=p){case 0:for(p=0,c=Math.pow(2,8),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;l=r(p);break;case 1:for(p=0,c=Math.pow(2,16),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;l=r(p);break;case 2:return""}for(f[3]=l,s=l,w.push(l);;){if(A.index>o)return"";for(p=0,c=Math.pow(2,m),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;switch(l=p){case 0:for(p=0,c=Math.pow(2,8),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;f[d++]=r(p),l=d-1,h--;break;case 1:for(p=0,c=Math.pow(2,16),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;f[d++]=r(p),l=d-1,h--;break;case 2:return w.join("")}if(0==h&&(h=Math.pow(2,m),m++),f[l])v=f[l];else{if(l!==d)return null;v=s+s.charAt(0)}w.push(v),f[d++]=s+v.charAt(0),h--,s=v,0==h&&(h=Math.pow(2,m),m++)}}};return i}();"function"==typeof define&&define.amd?define(function(){return LZString}):"undefined"!=typeof module&&null!=module&&(module.exports=LZString);

// ==================== CONFIGURATION ====================
const COST_MULTIPLIER = 1.5;

// ==================== EDITOR STATE ====================
let editorUpgrades = [];
let upgradeIdCounter = 0;

// Initialize with 3 default upgrades
function initEditor() {
    addUpgrade(1, 0, "Starter Boost", "+1 click power", 50);
    addUpgrade(0, 1, "Auto Clicker", "+1 per second", 100);
    addUpgrade(5, 5, "Super Upgrade", "+5 power, +5/sec", 500);
    updatePreview();
    
    // Add event listeners for live preview
    document.getElementById('game-name').addEventListener('input', updatePreview);
    document.getElementById('clicker-image').addEventListener('input', updatePreview);
    document.getElementById('background-image').addEventListener('input', updatePreview);
    document.getElementById('unit-name').addEventListener('input', updatePreview);
}

function addUpgrade(clicks = 0, auto = 0, title = "", subtitle = "", cost = 100) {
    const id = upgradeIdCounter++;
    editorUpgrades.push({ id, clicks, auto, title, subtitle, cost });
    renderUpgradeList();
}

function removeUpgrade(id) {
    editorUpgrades = editorUpgrades.filter(u => u.id !== id);
    renderUpgradeList();
}

function updateUpgradeField(id, field, value) {
    const upgrade = editorUpgrades.find(u => u.id === id);
    if (upgrade) {
        if (field === 'clicks' || field === 'auto' || field === 'cost') {
            upgrade[field] = parseInt(value) || 0;
        } else {
            upgrade[field] = value;
        }
    }
}

function renderUpgradeList() {
    const container = document.getElementById('upgrade-list');
    container.innerHTML = '';
    
    editorUpgrades.forEach((upgrade, index) => {
        const card = document.createElement('div');
        card.className = 'upgrade-card';
        card.innerHTML = `
            <div class="upgrade-card-header">
                <span>Upgrade #${index + 1}</span>
                <button class="btn btn-danger" onclick="removeUpgrade(${upgrade.id})">‚úï Remove</button>
            </div>
            <div class="form-group">
                <input type="text" placeholder="Title (e.g., Super Clicker)" 
                       value="${escapeHtml(upgrade.title)}"
                       onchange="updateUpgradeField(${upgrade.id}, 'title', this.value)">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <input type="number" placeholder="Click Power" min="0"
                           value="${upgrade.clicks}"
                           onchange="updateUpgradeField(${upgrade.id}, 'clicks', this.value)">
                    <small>Power per click</small>
                </div>
                <div class="form-group">
                    <input type="number" placeholder="Auto/sec" min="0"
                           value="${upgrade.auto}"
                           onchange="updateUpgradeField(${upgrade.id}, 'auto', this.value)">
                    <small>Per second</small>
                </div>
            </div>
            <div class="form-group">
                <input type="number" placeholder="Base Cost" min="1"
                       value="${upgrade.cost}"
                       onchange="updateUpgradeField(${upgrade.id}, 'cost', this.value)">
                <small>Base cost (increases 1.5x per purchase)</small>
            </div>
            <div class="form-group">
                <textarea placeholder="Description (optional)"
                          onchange="updateUpgradeField(${upgrade.id}, 'subtitle', this.value)">${escapeHtml(upgrade.subtitle)}</textarea>
            </div>
        `;
        container.appendChild(card);
    });
}

function updatePreview() {
    const name = document.getElementById('game-name').value || 'My Clicker Game';
    const clickerImg = document.getElementById('clicker-image').value;
    const bgImg = document.getElementById('background-image').value;
    const unit = document.getElementById('unit-name').value || 'points';
    
    document.getElementById('preview-title').textContent = name;
    document.getElementById('preview-unit').textContent = unit;
    
    const previewClicker = document.getElementById('preview-clicker');
    if (clickerImg) {
        previewClicker.innerHTML = `<img src="${escapeHtml(clickerImg)}" alt="Preview" onerror="this.parentElement.innerHTML='<div class=preview-clicker-placeholder>Image failed to load</div>'">`;
    } else {
        previewClicker.innerHTML = '<div class="preview-clicker-placeholder">Add an image URL above</div>';
    }
    
    const previewGame = document.getElementById('preview-game');
    if (bgImg) {
        previewGame.style.backgroundImage = `url('${bgImg}')`;
    } else {
        previewGame.style.backgroundImage = 'none';
    }
}

// ==================== GAME GENERATION ====================
function generateGame() {
    const name = document.getElementById('game-name').value || 'My Clicker Game';
    const clickerImg = document.getElementById('clicker-image').value;
    const bgImg = document.getElementById('background-image').value;
    const unit = document.getElementById('unit-name').value || 'points';
    
    // Validate
    if (editorUpgrades.length === 0) {
        alert('Please add at least one upgrade!');
        return;
    }
    
    if (!editorUpgrades.every(u => u.title && u.cost > 0)) {
        alert('Please fill in all upgrade titles and costs!');
        return;
    }
    
    // Build config object
    const config = {
        n: name,
        i: clickerImg,
        b: bgImg,
        u: unit,
        g: editorUpgrades.map(u => [u.clicks, u.auto, u.title, u.subtitle, u.cost])
    };
    
    // Compress
    const compressed = LZString.compressToEncodedURIComponent(JSON.stringify(config));
    const url = window.location.origin + window.location.pathname + '?g=' + compressed;
    
    // Show link
    document.getElementById('link-section').style.display = 'block';
    document.getElementById('generated-link').value = url;
}

function copyLink() {
    const input = document.getElementById('generated-link');
    input.select();
    document.execCommand('copy');
    showToast('Link copied to clipboard!');
}

function playGame() {
    window.location.href = document.getElementById('generated-link').value;
}

// ==================== GAME ENGINE ====================
let gameConfig = null;
let gameState = null;
let clickPower = 1;
let autoPerSec = 0;

function initGame(config) {
    gameConfig = config;
    
    // Generate unique save key based on config hash
    const configStr = JSON.stringify(config);
    const saveKey = 'clickerSave_' + hashCode(configStr);
    
    // Load or create game state
    const saved = localStorage.getItem(saveKey);
    if (saved) {
        try {
            gameState = JSON.parse(saved);
            if (!gameState.ownedUpgrades || gameState.ownedUpgrades.length !== config.g.length) {
                gameState.ownedUpgrades = new Array(config.g.length).fill(0);
            }
        } catch (e) {
            gameState = { count: 0, ownedUpgrades: new Array(config.g.length).fill(0) };
        }
    } else {
        gameState = { count: 0, ownedUpgrades: new Array(config.g.length).fill(0) };
    }
    
    // Setup UI
    document.getElementById('game-title').textContent = config.n;
    document.getElementById('game-clicker-img').src = config.i || 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="%236366f1"/><text x="50" y="60" text-anchor="middle" fill="white" font-size="30">?</text></svg>';
    
    if (config.b) {
        document.getElementById('game-wrapper').style.backgroundImage = `url('${config.b}')`;
    }
    
    // Compute powers
    computePowers();
    updateGameUI();
    
    // Setup clicker
    document.getElementById('game-clicker').addEventListener('click', handleClick);
    
    // Game loops
    setInterval(() => {
        if (autoPerSec > 0) {
            gameState.count += autoPerSec / 20;
            updateGameUI();
        }
    }, 50);
    
    // Save loop
    setInterval(() => {
        localStorage.setItem(saveKey, JSON.stringify(gameState));
    }, 1000);
    
    // Shop update loop
    setInterval(() => {
        if (document.getElementById('shop-view').classList.contains('active')) {
            renderShop();
        }
    }, 500);
    
    // Show player mode
    document.getElementById('editor-mode').style.display = 'none';
    document.getElementById('player-mode').style.display = 'block';
}

function computePowers() {
    clickPower = 1;
    autoPerSec = 0;
    
    gameConfig.g.forEach((upgrade, i) => {
        const owned = gameState.ownedUpgrades[i] || 0;
        clickPower += upgrade[0] * owned;
        autoPerSec += upgrade[1] * owned;
    });
}

function updateGameUI() {
    const countStr = formatNumber(Math.floor(gameState.count)) + ' ' + gameConfig.u;
    document.getElementById('game-count').textContent = countStr;
    document.getElementById('shop-count').textContent = countStr;
    document.getElementById('stat-power').textContent = formatNumber(clickPower);
    document.getElementById('stat-auto').textContent = formatNumber(autoPerSec);
}

function handleClick(e) {
    gameState.count += clickPower;
    updateGameUI();
    
    // Visual effect
    const effect = document.createElement('div');
    effect.className = 'click-effect';
    effect.textContent = '+' + formatNumber(clickPower);
    effect.style.left = e.clientX + 'px';
    effect.style.top = e.clientY + 'px';
    document.body.appendChild(effect);
    setTimeout(() => effect.remove(), 800);
}

function showView(view) {
    const mainView = document.getElementById('main-view');
    const shopView = document.getElementById('shop-view');
    const navButtons = document.querySelectorAll('.game-nav button');
    
    if (view === 'main') {
        mainView.classList.remove('hidden');
        shopView.classList.remove('active');
        navButtons[0].classList.add('active');
        navButtons[1].classList.remove('active');
    } else {
        mainView.classList.add('hidden');
        shopView.classList.add('active');
        navButtons[0].classList.remove('active');
        navButtons[1].classList.add('active');
        renderShop();
    }
}

function renderShop() {
    const container = document.getElementById('shop-list');
    container.innerHTML = '';
    
    gameConfig.g.forEach((upgrade, i) => {
        const [clicks, auto, title, subtitle, baseCost] = upgrade;
        const owned = gameState.ownedUpgrades[i] || 0;
        const cost = Math.ceil(baseCost * Math.pow(COST_MULTIPLIER, owned));
        const canAfford = gameState.count >= cost;
        
        // Visibility logic
        let isVisible = i === 0;
        if (i > 0) {
            const prevOwned = gameState.ownedUpgrades[i - 1] > 0;
            const prevCost = gameConfig.g[i - 1][4];
            isVisible = prevOwned || gameState.count >= prevCost;
        }
        
        const item = document.createElement('div');
        item.className = 'shop-item';
        
        if (!isVisible) {
            item.classList.add('hidden');
            item.innerHTML = `
                <div class="shop-item-info">
                    <div class="shop-item-title">???</div>
                    <div class="shop-item-subtitle">Unlock previous upgrades to reveal</div>
                </div>
                <div class="shop-item-meta">
                    <div class="shop-item-cost">???</div>
                </div>
            `;
        } else {
            if (!canAfford) item.classList.add('locked');
            
            let desc = subtitle || '';
            if (!desc) {
                const parts = [];
                if (clicks > 0) parts.push(`+${clicks} click power`);
                if (auto > 0) parts.push(`+${auto}/sec`);
                desc = parts.join(', ');
            }
            
            item.innerHTML = `
                <div class="shop-item-info">
                    <div class="shop-item-title">${escapeHtml(title)}</div>
                    <div class="shop-item-subtitle">${escapeHtml(desc)}</div>
                </div>
                <div class="shop-item-meta">
                    <div class="shop-item-cost">${formatNumber(cost)} ${gameConfig.u}</div>
                    <div class="shop-item-owned">Owned: ${owned}</div>
                </div>
            `;
            
            if (canAfford) {
                item.addEventListener('click', () => buyUpgrade(i));
            }
        }
        
        container.appendChild(item);
    });
}

function buyUpgrade(index) {
    const upgrade = gameConfig.g[index];
    const owned = gameState.ownedUpgrades[index] || 0;
    const cost = Math.ceil(upgrade[4] * Math.pow(COST_MULTIPLIER, owned));
    
    if (gameState.count >= cost) {
        gameState.count -= cost;
        gameState.ownedUpgrades[index]++;
        computePowers();
        updateGameUI();
        renderShop();
        showToast(`Purchased ${upgrade[2]}!`);
    }
}

// ==================== UTILITIES ====================
function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

function hashCode(str) {
    let hash = 0;
    for (let i = 0; i < str.length; i++) {
        const char = str.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash;
    }
    return Math.abs(hash).toString(36);
}

function formatNumber(num) {
    if (num >= 1e15) return (num / 1e15).toFixed(2) + 'Q';
    if (num >= 1e12) return (num / 1e12).toFixed(2) + 'T';
    if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
    if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
    if (num >= 1e3) return (num / 1e3).toFixed(2) + 'K';
    return Math.floor(num).toLocaleString();
}

function showToast(message) {
    const toast = document.createElement('div');
    toast.className = 'toast';
    toast.textContent = message;
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 2000);
}

// ==================== INITIALIZATION ====================
document.addEventListener('DOMContentLoaded', () => {
    // Check for game data in URL
    const params = new URLSearchParams(window.location.search);
    const gameData = params.get('g');
    
    if (gameData) {
        try {
            const decompressed = LZString.decompressFromEncodedURIComponent(gameData);
            const config = JSON.parse(decompressed);
            
            // Validate config
            if (config.n && config.g && Array.isArray(config.g)) {
                document.title = config.n + ' - Clicker Game';
                initGame(config);
            } else {
                throw new Error('Invalid config');
            }
        } catch (e) {
            console.error('Failed to load game:', e);
            alert('Failed to load game. The link may be corrupted.');
            initEditor();
        }
    } else {
        initEditor();
    }
});
</script>

</body>
</html>
